<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="vhiddigi_files/filelist.xml">
<link rel=Edit-Time-Data href="vhiddigi_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>Vserial</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Vijay Rangasamy</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>Vijay Rangasamy</o:LastAuthor>
  <o:Revision>1</o:Revision>
  <o:TotalTime>2</o:TotalTime>
  <o:Created>2006-02-09T00:27:00Z</o:Created>
  <o:LastSaved>2006-02-09T00:30:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>528</o:Words>
  <o:Characters>3016</o:Characters>
  <o:Company>Microsoft Corporation</o:Company>
  <o:Lines>25</o:Lines>
  <o:Paragraphs>7</o:Paragraphs>
  <o:CharactersWithSpaces>3537</o:CharactersWithSpaces>
  <o:Version>11.6568</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:PunctuationKerning/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Trebuchet MS";
	panose-1:2 11 6 3 2 2 2 2 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:647 0 0 0 159 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
span.EmailStyle15
	{mso-style-type:personal;
	mso-style-noshow:yes;
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Trebuchet MS";
	mso-ascii-font-family:"Trebuchet MS";
	mso-hansi-font-family:"Trebuchet MS";
	color:navy;
	font-weight:normal;
	font-style:normal;
	text-decoration:none;
	text-underline:none;
	text-decoration:none;
	text-line-through:none;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:1672679736;
	mso-list-type:hybrid;
	mso-list-template-ids:941503370 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l0:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=EN-US style='tab-interval:.5in'>

<div class=Section1>

<p class=MsoNormal><span class=SpellE><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:Arial'>Vserial.sys</span></b></span><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
Arial'> (Virtual Serial Driver)<o:p></o:p></span></b></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:Arial'>A driver that
talks to a device that gets data from human interaction is a huge challenge. Virtual
Serial Driver helps to simulate the existence of an actual device when the
device is absent. The helps to easily test for functionality, error conditions,
scenarios that are hard to occur in reality, etc. while the driver still in
development. <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:Arial'>How it works:
<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:Arial'>This device
driver takes advantage of the fact that it sits below the pen driver to
simulate the data input from a device by reading data from a file and sending
it up the device stack. This way, the pen driver can be tested using data that
will normally be generated by the device. In addition, bad device data can be
simulated with ease. The driver can also simulate error scenarios that are not
related to data<span class=GramE>..</span> The invention also allows the
testing of a device driver on platforms that don’t currently have real
digitizer hardware (e.g. amd64)</span><span style='font-size:10.0pt;font-family:
"Trebuchet MS";color:navy'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Trebuchet MS";
color:navy'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:Arial'>The device
driver stack for the pen digitizer has the following members<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level1 lfo1;
tab-stops:list .5in'><![if !supportLists]><span style='font-size:9.0pt;
font-family:Arial;mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:9.0pt;font-family:Arial'>Hid class driver (upper filter
driver)<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level1 lfo1;
tab-stops:list .5in'><![if !supportLists]><span style='font-size:9.0pt;
font-family:Arial;mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:9.0pt;font-family:Arial'>Hid (pen) mini driver (<span
class=SpellE>upder</span> filter driver)<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level1 lfo1;
tab-stops:list .5in'><![if !supportLists]><span style='font-size:9.0pt;
font-family:Arial;mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:9.0pt;font-family:Arial'>Serial driver (function driver)<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in;mso-list:l0 level1 lfo1;
tab-stops:list .5in'><![if !supportLists]><span style='font-size:9.0pt;
font-family:Arial;mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:9.0pt;font-family:Arial'>ACPI driver (physical device driver)<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:Arial'><!--[if gte vml 1]><v:shapetype
 id="_x0000_t75" coordsize="21600,21600" o:spt="75" o:preferrelative="t"
 path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="_x0000_i1025" type="#_x0000_t75" style='width:6in;
 height:252pt'>
 <v:imagedata src="vhiddigi_files/image001.emz" o:title=""/>
</v:shape><![endif]--><![if !vml]><img width=576 height=336
src="vhiddigi_files/image002.gif" v:shapes="_x0000_i1025"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.25in'><span style='font-size:9.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:Arial'>When
interacting with the digitizer, the user causes data to be generated by the
device. The device generates interrupts when it has data available. These
interrupts are handled by the serial port driver which sends the data up the
driver stack. Between the upper filter mini driver and the hid class driver,
then data is parsed and sent to any user mode application that has requested to
receive data from the digitizer. <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:Arial'>The virtual
driver replaces the serial port driver. The <span class=SpellE><span
class=GramE>inf</span></span> file of the pen mini driver needs to reference
the virtual serial driver instead of the real serial port driver. Once the
virtual driver is loaded it waits for the data file to be placed in a specific
location. Once it detects the file, it starts reading it and using the data in
it to complete read requests sent down by the pen driver. This gives the pen
driver the impression that it’s actually getting data from a digitizer.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<div style='mso-element:para-border-div;border:none;border-bottom:solid windowtext 1.5pt;
padding:0in 0in 1.0pt 0in'>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 1.0pt 0in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:Arial'>Simulating Valid Device
Data</span></b><span style='font-size:9.0pt;font-family:Arial'>:<o:p></o:p></span></p>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 1.0pt 0in'><span style='font-size:9.0pt;
font-family:Arial'>The pen driver sends an IRP (I/O request packet) to the
serial driver to get data. Once the virtual serial driver gets the IRP, it
stores it in a queue. It reads the data from the file from a separate system
thread for 2 reasons:<o:p></o:p></span></p>

</div>

<div style='mso-element:para-border-div;border:none;border-bottom:solid windowtext 1.5pt;
padding:0in 0in 21.0pt 0in'>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 21.0pt 0in'><span style='font-size:9.0pt;
font-family:Arial'><span style='mso-spacerun:yes'> </span>1. Files must be read
at PASSIVE_LEVEL in the kernel<o:p></o:p></span></p>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 21.0pt 0in'><span style='font-size:9.0pt;
font-family:Arial'>2. Enable asynchronous data processing.<o:p></o:p></span></p>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 21.0pt 0in'><span style='font-size:9.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 21.0pt 0in'><span style='font-size:9.0pt;
font-family:Arial'>In the thread where to data is being read from the file, the
virtual driver checks for pending read <span class=SpellE><span class=GramE>IRPs</span></span><span
class=GramE>.</span> If there are any available, the virtual driver uses the
data from the file to complete the read request.<o:p></o:p></span></p>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 21.0pt 0in'><span style='font-size:9.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 21.0pt 0in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:Arial'>Simulating Invalid Data
and Device Error:<o:p></o:p></span></b></p>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 21.0pt 0in'><span style='font-size:9.0pt;
font-family:Arial'>The virtual driver has a registry setting that tells it to
fail the <b style='mso-bidi-font-weight:normal'>nth</b> read/write IRP it
receives. Before processing any request, the virtual driver checks to see if <b
style='mso-bidi-font-weight:normal'>n</b> is equal to the current request. If
it is, the driver will generate an error message. This ensures that the pen
driver can be tested for proper error handling.<o:p></o:p></span></p>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 21.0pt 0in'><span style='font-size:9.0pt;
font-family:Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 21.0pt 0in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 21.0pt 0in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:Arial'>Plug and Play and Power
Management:<o:p></o:p></span></b></p>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 21.0pt 0in'><span style='font-size:9.0pt;
font-family:Arial'>The virtual serial driver does basic handling of <span
class=SpellE>Pnp</span> and Power management <span class=SpellE>IRPs</span>.
Unlike the real serial driver, it does not have the capability of being the
power policy owner. This is because the Hid-class driver acts as the power
policy owner for hid mini-drivers (in this case, the pen driver).<o:p></o:p></span></p>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 21.0pt 0in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:Arial'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 21.0pt 0in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:Arial'>Contents of Data File:<o:p></o:p></span></b></p>

<p class=MsoNormal style='border:none;mso-border-bottom-alt:solid windowtext 1.5pt;
padding:0in;mso-padding-alt:0in 0in 21.0pt 0in'><span style='font-size:9.0pt;
font-family:Arial'>The content of the data file is device specific. It’s up to
the user to record binary data as it comes in from the real device and store it
in the data file<o:p></o:p></span></p>

</div>

</div>

</body>

</html>
